# File Storage Module - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT (Frontend/User)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           API LAYER (Controllers)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        FileController.java                              â”‚    â”‚
â”‚  â”‚                                                                          â”‚    â”‚
â”‚  â”‚  POST   /api/files/products/{id}/images    (Upload - Admin)           â”‚    â”‚
â”‚  â”‚  GET    /api/files/products/{id}/images    (List - Public)            â”‚    â”‚
â”‚  â”‚  GET    /api/files/images/{id}             (Serve - Public)           â”‚    â”‚
â”‚  â”‚  PATCH  /api/files/images/{id}             (Update - Admin)           â”‚    â”‚
â”‚  â”‚  DELETE /api/files/images/{id}             (Delete - Admin)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       SERVICE LAYER (Business)      â”‚  â”‚    EXCEPTION HANDLING                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ProductImageService.java   â”‚    â”‚  â”‚  â”‚ FileExceptionHandler.java    â”‚   â”‚
â”‚  â”‚ (Product-Specific Logic)   â”‚    â”‚  â”‚  â”‚                               â”‚   â”‚
â”‚  â”‚ â€¢ Upload image             â”‚    â”‚  â”‚  â”‚ â€¢ FileStorageException        â”‚   â”‚
â”‚  â”‚ â€¢ Set primary image        â”‚    â”‚  â”‚  â”‚ â€¢ FileNotFoundException       â”‚   â”‚
â”‚  â”‚ â€¢ Manage display order     â”‚    â”‚  â”‚  â”‚ â€¢ InvalidFileTypeException    â”‚   â”‚
â”‚  â”‚ â€¢ CRUD operations          â”‚    â”‚  â”‚  â”‚ â€¢ ProductImageNotFoundExceptionâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ FileStorageService.java â­ â”‚    â”‚
â”‚  â”‚ (REUSABLE CORE)            â”‚    â”‚
â”‚  â”‚ â€¢ Store file               â”‚    â”‚
â”‚  â”‚ â€¢ Delete file              â”‚    â”‚
â”‚  â”‚ â€¢ Load file as resource    â”‚    â”‚
â”‚  â”‚ â€¢ Validate file type/size  â”‚    â”‚
â”‚  â”‚ â€¢ Subdirectory support     â”‚    â”‚
â”‚  â”‚ â€¢ Path traversal protectionâ”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FILE SYSTEM       â”‚  â”‚   REPOSITORY LAYER           â”‚
â”‚                     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  uploads/           â”‚  â”‚  â”‚ ProductImageRepository  â”‚ â”‚
â”‚  â””â”€â”€ products/      â”‚  â”‚  â”‚ â€¢ findByPublicId        â”‚ â”‚
â”‚      â”œâ”€â”€ uuid1.jpg  â”‚  â”‚  â”‚ â€¢ findByProductId       â”‚ â”‚
â”‚      â”œâ”€â”€ uuid2.png  â”‚  â”‚  â”‚ â€¢ clearPrimaryForProductâ”‚ â”‚
â”‚      â””â”€â”€ uuid3.webp â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ FileMetadataRepository  â”‚ â”‚
                         â”‚  â”‚ â€¢ findByPublicId        â”‚ â”‚
                         â”‚  â”‚ â€¢ findByFileName        â”‚ â”‚
                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ENTITY LAYER (Domain Models)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ProductImage.java      â”‚  â”‚ FileMetadata.java      â”‚  â”‚ Product.java     â”‚ â”‚
â”‚  â”‚ â€¢ publicId             â”‚  â”‚ â€¢ publicId             â”‚  â”‚ â€¢ images         â”‚ â”‚
â”‚  â”‚ â€¢ product (FK)         â”‚  â”‚ â€¢ fileName             â”‚  â”‚ (OneToMany)      â”‚ â”‚
â”‚  â”‚ â€¢ fileMetadata (FK)    â”‚  â”‚ â€¢ originalFileName     â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚ â€¢ isPrimary            â”‚  â”‚ â€¢ filePath             â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚ â€¢ displayOrder         â”‚  â”‚ â€¢ fileSize             â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚ â€¢ altText              â”‚  â”‚ â€¢ contentType          â”‚  â”‚                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ fileType             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            DATABASE (MySQL)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ product_image          â”‚  â”‚ file_metadata          â”‚  â”‚ product          â”‚ â”‚
â”‚  â”‚ â€¢ id (PK)              â”‚  â”‚ â€¢ id (PK)              â”‚  â”‚ â€¢ id (PK)        â”‚ â”‚
â”‚  â”‚ â€¢ public_id (UNIQUE)   â”‚  â”‚ â€¢ public_id (UNIQUE)   â”‚  â”‚ â€¢ public_id      â”‚ â”‚
â”‚  â”‚ â€¢ product_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â†’ â€¢ file_name            â”‚  â”‚ â€¢ name           â”‚ â”‚
â”‚  â”‚ â€¢ file_metadata_id â”€â”€â”€â”€â”€â”€â”€â”€â†’ â€¢ original_file_name  â”‚  â”‚ â€¢ sku            â”‚ â”‚
â”‚  â”‚ â€¢ is_primary           â”‚  â”‚ â€¢ file_path            â”‚  â”‚ â€¢ ...            â”‚ â”‚
â”‚  â”‚ â€¢ display_order        â”‚  â”‚ â€¢ file_size            â”‚  â”‚                  â”‚ â”‚
â”‚  â”‚ â€¢ alt_text             â”‚  â”‚ â€¢ content_type         â”‚  â”‚                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â€¢ file_type (ENUM)     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EXTENSIBILITY - FUTURE ENTITIES                           â”‚
â”‚                                                                                  â”‚
â”‚  FileStorageService (Reusable Core) can be used by:                            â”‚
â”‚                                                                                  â”‚
â”‚  â€¢ CategoryImageService  â†’ category_image table                                â”‚
â”‚  â€¢ UserAvatarService     â†’ user_avatar table                                   â”‚
â”‚  â€¢ BlogPostMediaService  â†’ blog_media table                                    â”‚
â”‚  â€¢ ReviewImageService    â†’ review_image table                                  â”‚
â”‚  â€¢ ... and more!                                                                â”‚
â”‚                                                                                  â”‚
â”‚  Pattern:                                                                        â”‚
â”‚  1. Create entity-specific table (references file_metadata)                    â”‚
â”‚  2. Create entity class                                                         â”‚
â”‚  3. Create repository                                                           â”‚
â”‚  4. Create service (uses FileStorageService)                                   â”‚
â”‚  5. Add controller endpoints                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                               DATA FLOW EXAMPLE                                  â”‚
â”‚                         (Upload Product Image)                                   â”‚
â”‚                                                                                  â”‚
â”‚  1. Client sends POST with multipart/form-data                                 â”‚
â”‚     â””â†’ FileController receives request                                          â”‚
â”‚                                                                                  â”‚
â”‚  2. Controller delegates to ProductImageService                                 â”‚
â”‚     â””â†’ Validates product exists                                                 â”‚
â”‚     â””â†’ Calls FileStorageService.storeFile()                                    â”‚
â”‚                                                                                  â”‚
â”‚  3. FileStorageService:                                                         â”‚
â”‚     â””â†’ Validates file type (JPEG, PNG, GIF, WebP)                              â”‚
â”‚     â””â†’ Validates file size (< 10MB)                                            â”‚
â”‚     â””â†’ Generates UUID filename                                                  â”‚
â”‚     â””â†’ Saves to uploads/products/uuid.jpg                                      â”‚
â”‚     â””â†’ Returns file path                                                        â”‚
â”‚                                                                                  â”‚
â”‚  4. ProductImageService:                                                        â”‚
â”‚     â””â†’ Creates FileMetadata entity                                             â”‚
â”‚     â””â†’ Creates ProductImage entity                                             â”‚
â”‚     â””â†’ Links to Product                                                         â”‚
â”‚     â””â†’ Saves to database                                                        â”‚
â”‚     â””â†’ Returns ProductImageResponse                                            â”‚
â”‚                                                                                  â”‚
â”‚  5. Controller returns 201 Created with response                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SECURITY & VALIDATION FLOW                             â”‚
â”‚                                                                                  â”‚
â”‚  Request â†’ Security Filter â†’ Authorization Check                               â”‚
â”‚                                   â”‚                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                        â–¼                     â–¼                                  â”‚
â”‚                  ADMIN Required        PUBLIC Access                            â”‚
â”‚                  â€¢ Upload              â€¢ View Images                            â”‚
â”‚                  â€¢ Update              â€¢ Get Images                             â”‚
â”‚                  â€¢ Delete              â€¢ Serve Files                            â”‚
â”‚                                                                                  â”‚
â”‚  Validation Chain:                                                              â”‚
â”‚  1. Spring Security â†’ Role check                                               â”‚
â”‚  2. Controller â†’ Input validation                                              â”‚
â”‚  3. FileStorageService â†’ File type validation                                  â”‚
â”‚  4. FileStorageService â†’ File size validation                                  â”‚
â”‚  5. FileStorageService â†’ Path traversal check                                  â”‚
â”‚  6. Exception Handler â†’ Proper error response                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Components Explained

### ğŸ¯ FileStorageService (The Reusable Core)
- **Generic file operations** - Works with any file type
- **Configurable** - Storage location, max size from config
- **Secure** - Validates file types, sizes, prevents path traversal
- **Organized** - Supports subdirectories for different entities
- **Can be used by any service** that needs file storage

### ğŸ–¼ï¸ ProductImageService
- **Product-specific logic** - Manages product-image relationships
- **Uses FileStorageService** - Delegates actual file operations
- **Metadata management** - Primary image, display order, alt text
- **Full CRUD** - Create, read, update, delete operations

### ğŸ—„ï¸ Database Design
- **file_metadata** - Reusable, entity-agnostic file storage
- **product_image** - Product-specific relationship table
- **Cascade deletes** - Automatic cleanup when products are deleted
- **Indexes** - Optimized queries for common operations

### ğŸ”’ Security
- **Admin-only modifications** - Upload, update, delete require ADMIN role
- **Public read access** - Anyone can view/download images
- **File validation** - Type and size checks
- **Path protection** - Prevents directory traversal attacks

### ğŸ“ File Organization
```
uploads/
â””â”€â”€ products/          (organized by entity type)
    â”œâ”€â”€ {uuid1}.jpg    (unique UUID names)
    â”œâ”€â”€ {uuid2}.png
    â””â”€â”€ {uuid3}.webp
```

### ğŸ”„ Extensibility Pattern
To add images to any other entity, follow the same pattern:
1. Create `{entity}_image` table
2. Create entity and repository
3. Create service using `FileStorageService`
4. Add controller endpoints
